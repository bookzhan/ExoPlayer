// Copyright (C) 2016 The Android Open Source Project
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
apply from: "$gradle.ext.exoplayerSettingsDir/common_library_config.gradle"
apply plugin:"com.kezong.fat-aar"
apply plugin: 'maven'
apply plugin: 'maven-publish'

ext {
    NEXUS_USER = ''
    NEXUS_PASSWORD = ''
    RELEASE_SNAPSHOT = false

    POM_URL_SNAP = 'https://www.raoyunsoft.com/nexus/repository/maven-snapshots/'
    POM_URL = 'https://www.raoyunsoft.com/nexus/repository/maven-releases/'

    POM_GROUP_ID = 'com.guaishou.bzlib'
    POM_ATRIFACT_ID = 'exoplayer'
    POM_VERSION = '2.14.1-5'
}
if (System.getenv('NEXUS_USER')) {
    NEXUS_USER = System.getenv('NEXUS_USER')
}
if (System.getenv('NEXUS_PASSWORD')) {
    NEXUS_PASSWORD = System.getenv('NEXUS_PASSWORD')
}
println("NEXUS_USER=" + NEXUS_USER + " NEXUS_PASSWORD=" + NEXUS_PASSWORD)

// 上传到私服
uploadArchives {
    repositories {
        mavenDeployer {
            if (RELEASE_SNAPSHOT) {
                //snapshot环境
                snapshotRepository(url: POM_URL_SNAP) {
                    authentication(userName: NEXUS_USER, password: NEXUS_PASSWORD)
                }
                POM_VERSION += "-SNAPSHOT"
            } else {
                //正式环境
                repository(url: POM_URL) {
                    authentication(userName: NEXUS_USER, password: NEXUS_PASSWORD)
                }
            }

            pom.groupId = POM_GROUP_ID
            pom.artifactId = POM_ATRIFACT_ID
            pom.version = POM_VERSION

            pom.project {
                licenses {
                    license {
                        name 'The Apache Software License, Version 2.0'
                        url 'http://www.apache.org/licenses/LICENSE-2.0.txt'
                    }
                }
            }
        }
    }
}
task androidSourcesJar(type: Jar) {
    archiveClassifier.set('sources')
    from ('../common/src/main/java','../core/src/main/java','../dash/src/main/java','../extractor/src/main/java','../hls/src/main/java','../rtsp/src/main/java','../smoothstreaming/src/main/java','../transformer/src/main/java','../ui/src/main/java')
}
artifacts {
    archives androidSourcesJar
}

dependencies {
    implementation ('com.google.guava:guava:' + guavaVersion) {
        // Exclude dependencies that are only used by Guava at compile time
        // (but declared as runtime deps) [internal b/168188131].
        exclude group: 'com.google.code.findbugs', module: 'jsr305'
        exclude group: 'org.checkerframework', module: 'checker-compat-qual'
        exclude group: 'com.google.errorprone', module: 'error_prone_annotations'
        exclude group: 'com.google.j2objc', module: 'j2objc-annotations'
        exclude group: 'org.codehaus.mojo', module: 'animal-sniffer-annotations'
    }
    embed project(modulePrefix + 'library-common')
    embed project(modulePrefix + 'library-extractor')
    embed project(modulePrefix + 'library-core')
    embed project(modulePrefix + 'library-dash')
    embed project(modulePrefix + 'library-hls')
    embed project(modulePrefix + 'library-rtsp')
    embed project(modulePrefix + 'library-smoothstreaming')
    embed project(modulePrefix + 'library-transformer')
    embed project(modulePrefix + 'library-ui')
}

//ext {
//    releaseArtifact = 'exoplayer'
//    releaseDescription = 'The ExoPlayer library (all modules).'
//}
//apply from: '../../publish.gradle'
